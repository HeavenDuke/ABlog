(function(d){d.fn.ajaxfileupload=function(c){var a={params:{},action:"",onStart:function(){},onComplete:function(a){},onCancel:function(){},validate_extensions:!0,valid_extensions:["gif","png","jpg","jpeg"],submit_button:null},e=!1;c&&d.extend(a,c);return this.each(function(){var b=d(this);if(!0!==b.data("ajaxUploader-setup")){b.change(function(){e=!1;null==a.submit_button&&c()});null!=a.submit_button&&a.submit_button.click(function(a){a.preventDefault();e||c()});var c=function(){if(""==b.val())return a.onCancel.apply(b,[a.params]);var g=b.val().split(".").pop().toLowerCase();!0===a.validate_extensions&&-1==d.inArray(g,a.valid_extensions)?a.onComplete.apply(b,[{status:!1,message:"The select file type is invalid. File must be "+a.valid_extensions.join(", ")+"."},a.params]):(e=!0,h(b),!1!==a.onStart.apply(b,[a.params])?b.parent("form").submit(function(a){a.stopPropagation()}).submit():e=!1)};b.data("ajaxUploader-setup",!0);var h=function(b){var c="ajaxUploader-iframe-"+Math.round((new Date).getTime()/1E3);d("body").after('<iframe width="0" height="0" style="display:none;" name="'+c+'" id="'+c+'"/>');d("#"+c).get(0).onload=function(){var c,f=d(this).contents().text();try{c=JSON.parse(f)}catch(k){c=f}b.siblings().remove();b.unwrap();e=!1;a.onComplete.apply(b,[c,a.params])};b.wrap(function(){return'<form action="'+a.action+'" method="POST" enctype="multipart/form-data" target="'+c+'" />'}).before(function(){var b,c="";for(b in a.params){var d=a.params[b];"function"===typeof d&&(d=d());c+='<input type="hidden" name="'+b+'" value="'+d+'" />'}return c})}}})}})(jQuery);